<!doctype html>
<html lang="th">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title id="pageTitle">Shopping Cart - Nexus Wear</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&amp;family=Bebas+Neue&amp;display=swap" rel="stylesheet">
  
  <script src="_sdk/element_sdk.js"></script>
  <script src="_sdk/data_sdk.js"></script>
  <script src="_sdk/data_utility.js"></script>
  <script src="_sdk/analytics_sdk.js"></script>
  
  <style>
        /* (CSS Styles are kept the same for brevity - Your original styles here) */
        /* Global Reset and Base Styles */
        body {
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
            background: #FFFFFF;
            color: #000000;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Layout */
        .page-wrapper {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header-main {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #e0e0e0;
            margin-bottom: 20px;
        }

        .brand-logo a {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2.5rem;
            text-decoration: none;
            color: #000000;
        }
        
        .cart-icon {
            position: relative;
            font-size: 1.5rem;
        }
        
        .cart-badge {
            position: absolute;
            top: -10px;
            right: -10px;
            background-color: #E70000;
            color: white;
            border-radius: 50%;
            padding: 2px 6px;
            font-size: 0.75rem;
            font-weight: 600;
            line-height: 1;
            text-align: center;
        }

        .cart-container {
            display: flex;
            gap: 40px;
        }
        
        .cart-items {
            flex: 2;
        }
        
        .cart-summary {
            flex: 1;
        }
        
        /* Item Styling */
        .cart-item {
            display: flex;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
            position: relative;
        }

        .item-image {
            width: 100px;
            height: 100px;
            object-fit: cover;
            margin-right: 20px;
        }
        
        .item-details {
            flex-grow: 1;
        }
        
        .item-name {
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .item-options {
            font-size: 0.9rem;
            color: #555;
            margin-bottom: 10px;
        }
        
        .item-price {
            font-weight: 500;
        }

        .item-actions {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .qty-input {
            width: 50px;
            padding: 5px;
            text-align: center;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        
        .remove-btn {
            background: none;
            border: none;
            color: #E70000;
            cursor: pointer;
            font-size: 0.9rem;
            text-decoration: underline;
        }

        /* Summary Styling */
        .summary-box {
            border: 1px solid #e0e0e0;
            padding: 20px;
        }
        
        .summary-box h2 {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.8rem;
            margin-bottom: 20px;
            letter-spacing: 1px;
        }
        
        .summary-details div {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .summary-total {
            border-top: 2px solid #000000;
            padding-top: 15px;
            margin-top: 15px;
            font-size: 1.2rem;
            font-weight: 700;
        }
        
        .summary-total span:last-child {
            color: #E70000;
        }
        
        .checkout-btn {
            width: 100%;
            padding: 15px;
            background-color: #000000;
            color: #FFFFFF;
            border: none;
            border-radius: 4px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
            transition: background-color 0.2s;
        }
        
        .checkout-btn:hover {
            background-color: #333333;
        }
        
        #emptyCartMessage {
            text-align: center;
            font-size: 1.2rem;
            color: #555;
            padding: 50px 0;
            display: none; /* Hidden by default */
        }
        
        /* Toast Notification (Basic Styling) */
        #toast {
            visibility: hidden; 
            min-width: 250px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 2px;
            padding: 16px;
            position: fixed;
            z-index: 1000;
            left: 50%;
            bottom: 30px;
            transform: translateX(-50%);
            font-size: 17px;
        }

        #toast.show {
            visibility: visible;
            -webkit-animation: fadein 0.5s, fadeout 0.5s 2.5s;
            animation: fadein 0.5s, fadeout 0.5s 2.5s;
        }
        
        /* Simple Animations for Toast */
        @-webkit-keyframes fadein { from { bottom: 0; opacity: 0; } to { bottom: 30px; opacity: 1; } }
        @keyframes fadein { from { bottom: 0; opacity: 0; } to { bottom: 30px; opacity: 1; } }
        @-webkit-keyframes fadeout { from { bottom: 30px; opacity: 1; } to { bottom: 0; opacity: 0; } }
        @keyframes fadeout { from { bottom: 30px; opacity: 1; } to { bottom: 0; opacity: 0; } }
        
        /* Responsive Adjustments */
        @media (max-width: 768px) {
            .cart-container {
                flex-direction: column;
                gap: 20px;
            }
            .cart-item {
                flex-wrap: wrap;
            }
            .item-image {
                width: 80px;
                height: 80px;
            }
        }
  </style>
 </head>
 <body>

  <div id="toast"></div>

  <div class="page-wrapper">
    <header class="header-main">
      <div class="brand-logo"><a href="index.html" id="brandLogo">NEXUS WEAR</a></div>
      <div class="cart-icon">
        <a href="cart.html">üõí</a>
        <span class="cart-badge" id="cartCountBadge">0</span>
      </div>
    </header>

    <main>
      <h1>SHOPPING CART</h1>
      
      <div id="loadingIndicator" style="text-align: center; padding: 20px; font-style: italic;">Loading cart...</div>
      <p id="emptyCartMessage" style="display: none;">‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ä‡πâ‡∏≠‡∏õ‡∏õ‡∏¥‡πâ‡∏á‡πÄ‡∏•‡∏¢!</p>

      <div class="cart-container" id="cartContent">
        
        <section class="cart-items">
          <div id="cartItemsList">
            </div>
          
          <button class="remove-btn" id="clearCartBtn" style="margin-top: 20px;">[ Clear All Items ]</button>
        </section>

        <section class="cart-summary">
          <div class="summary-box">
            <h2>ORDER SUMMARY</h2>
            
            <div class="summary-details">
              <div>
                <span>Subtotal:</span>
                <span id="subtotalAmount">0.00 THB</span>
              </div>
              <div>
                <span>Shipping:</span>
                <span id="shippingFee">50.00 THB</span>
              </div>
              <div class="summary-total">
                <span>Total:</span>
                <span id="totalAmount">50.00 THB</span>
              </div>
            </div>
            
            <a href="checkout.html">
                <button class="checkout-btn" id="goToCheckoutBtn">PROCEED TO CHECKOUT</button>
            </a>
          </div>
        </section>

      </div>
    </main>
  </div>

  <script>
    // Utility function to format currency
    const formatCurrency = (amount) => {
        return `${parseFloat(amount).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',')} THB`;
    };
    
    // Utility function to show Toast
    function showToast(message, type = 'info') {
        const toast = document.getElementById('toast');
        if (!toast) return;

        toast.textContent = message;
        toast.className = 'show'; 
        
        setTimeout(function(){ 
            toast.className = toast.className.replace("show", ""); 
        }, 3000);
    }

    // ===========================================
    // DATA SDK INTEGRATION & CART LOGIC
    // ===========================================
    
    const SHIPPING_FEE = 50.00; // Mock shipping fee

    /**
     * ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏à‡∏≤‡∏Å Data SDK ‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
     * @param {Array} cartData - ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏•‡πâ‡∏ß
     */
    function renderCart(cartData) {
        const cartItemsList = document.getElementById('cartItemsList');
        const cartContent = document.getElementById('cartContent');
        const emptyMessage = document.getElementById('emptyCartMessage');
        const loadingIndicator = document.getElementById('loadingIndicator');

        // ‡∏ã‡πà‡∏≠‡∏ô Loading
        if (loadingIndicator) loadingIndicator.style.display = 'none';

        if (!cartData || cartData.length === 0) {
            cartItemsList.innerHTML = '';
            cartContent.style.display = 'none';
            emptyMessage.style.display = 'block';
            document.getElementById('goToCheckoutBtn').disabled = true;
            document.getElementById('clearCartBtn').style.display = 'none';
        } else {
            emptyMessage.style.display = 'none';
            cartContent.style.display = 'flex'; // Display the cart content
            document.getElementById('goToCheckoutBtn').disabled = false;
            document.getElementById('clearCartBtn').style.display = 'block';
            
            // 1. Render Items
            cartItemsList.innerHTML = '';
            cartData.forEach(item => {
                // Ensure required properties exist for rendering
                if (!item.__backendId || !item.id) return; 
                
                const itemEl = document.createElement('div');
                itemEl.className = 'cart-item';
                itemEl.setAttribute('data-id', item.__backendId);
                
                itemEl.innerHTML = `
                    <img class="item-image" src="${item.image || 'placeholder.jpg'}" alt="${item.name}">
                    <div class="item-details">
                        <div class="item-name">${item.name}</div>
                        <div class="item-options">Size: ${item.size || 'N/A'}, Color: ${item.color || 'N/A'}</div>
                        <div class="item-price">Price: ${formatCurrency(item.price)}</div>
                        <div class="item-actions">
                            <label for="qty-${item.__backendId}">Qty:</label>
                            <input type="number" id="qty-${item.__backendId}" class="qty-input" min="1" value="${item.quantity}" data-backend-id="${item.__backendId}">
                            <button class="remove-btn" data-backend-id="${item.__backendId}">Remove</button>
                        </div>
                    </div>
                `;
                cartItemsList.appendChild(itemEl);
            });
        }
        
        // 2. Render Totals
        updateSummary(cartData);
        // 3. Re-attach listeners after rendering
        attachCartItemListeners();
    }
    
    /**
     * ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
     * @param {Array} cartData - ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
     */
    function updateSummary(cartData) {
        const subtotal = cartData.reduce((total, item) => total + (item.price * item.quantity), 0);
        const total = subtotal + SHIPPING_FEE;
        const count = cartData.reduce((total, item) => total + item.quantity, 0);

        document.getElementById('subtotalAmount').textContent = formatCurrency(subtotal);
        document.getElementById('shippingFee').textContent = formatCurrency(SHIPPING_FEE);
        document.getElementById('totalAmount').textContent = formatCurrency(total);
        document.getElementById('cartCountBadge').textContent = count;
    }

    /**
     * ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
     * @param {Event} e 
     */
    async function handleQuantityChange(e) {
        if (!window.dataSdk) return showToast('Data SDK not initialized.', 'error');
        
        const input = e.target;
        const backendId = input.getAttribute('data-backend-id');
        const newQuantity = parseInt(input.value);
        
        if (newQuantity < 1) {
            // If quantity goes to zero, treat it as a remove action
            return handleRemoveItem({ target: { getAttribute: () => backendId } });
        }
        
        const updateItem = {
            __backendId: backendId,
            quantity: newQuantity
        };
        
        const result = await window.dataSdk.update(updateItem);
        
        if (result.isOk) {
            showToast(`Updated quantity for item. New quantity: ${newQuantity}`);
            // renderCart will be called via the onDataChanged handler
        } else {
            showToast(`Failed to update item: ${result.error}`, 'error');
        }
    }

    /**
     * ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
     * @param {Event} e 
     */
    async function handleRemoveItem(e) {
        if (!window.dataSdk) return showToast('Data SDK not initialized.', 'error');
        
        const backendId = e.target.getAttribute('data-backend-id');
        
        const result = await window.dataSdk.delete({ __backendId: backendId });
        
        if (result.isOk) {
            showToast('Item removed from cart.', 'info');
            // renderCart will be called via the onDataChanged handler
        } else {
            showToast(`Failed to remove item: ${result.error}`, 'error');
        }
    }
    
    /**
     * ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
     */
    async function handleClearCart() {
        if (!window.dataSdk) return showToast('Data SDK not initialized.', 'error');
        
        if (!confirm('Are you sure you want to clear your entire cart?')) return;
        
        const result = await window.dataSdk.clear();
        
        if (result.isOk) {
            showToast('Cart has been cleared.', 'info');
            // renderCart will be called via the onDataChanged handler
        } else {
            showToast(`Failed to clear cart: ${result.error}`, 'error');
        }
    }

    /**
     * ‡∏ú‡∏π‡∏Å Event Listeners ‡∏Å‡∏±‡∏ö‡∏≠‡∏á‡∏Ñ‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
     */
    function attachCartItemListeners() {
        document.querySelectorAll('.qty-input').forEach(input => {
            // Remove previous listeners to prevent duplicates
            input.removeEventListener('change', handleQuantityChange);
            input.addEventListener('change', handleQuantityChange);
        });

        document.querySelectorAll('.remove-btn').forEach(button => {
            // Skip the clear cart button
            if (button.id === 'clearCartBtn') return; 
            
            button.removeEventListener('click', handleRemoveItem);
            button.addEventListener('click', handleRemoveItem);
        });
    }

    // ===========================================
    // ELEMENT SDK CONFIG
    // ===========================================

    const defaultConfig = { 
        page_title: 'SHOPPING CART', 
        empty_cart_message: '‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ä‡πâ‡∏≠‡∏õ‡∏õ‡∏¥‡πâ‡∏á‡πÄ‡∏•‡∏¢!', 
        brand_name: 'NEXUS WEAR', 
    };

    function handleConfigChange(config) {
        document.getElementById('pageTitle').textContent = config.page_title || defaultConfig.page_title;
        document.getElementById('emptyCartMessage').textContent = config.empty_cart_message || defaultConfig.empty_cart_message;
        document.getElementById('brandLogo').textContent = config.brand_name || defaultConfig.brand_name;
    }

    // ===========================================
    // INITIALIZATION
    // ===========================================

    async function initializeCartSystem() {
        // Initialize Data SDK and set up the change handler
        if (window.dataSdk) {
            await window.dataSdk.init({
                onDataChanged: (cartData) => {
                    renderCart(cartData);
                    // Tracking: Cart Updated (Optional)
                    if (window.analyticsSdk) {
                         window.analyticsSdk.trackEvent('CartViewed', {
                            item_count: cartData.reduce((total, item) => total + item.quantity, 0),
                            cart_total: cartData.reduce((total, item) => total + (item.price * item.quantity), 0)
                         });
                    }
                }
            });
        }
        
        // Initialize Element SDK
        if (window.elementSdk) {
            window.elementSdk.init({
                defaultConfig: defaultConfig,
                onConfigChange: handleConfigChange
            });
        }
        
        // Initialize Analytics SDK
        if (window.analyticsSdk) {
            window.analyticsSdk.init();
            window.analyticsSdk.trackPageView('Shopping Cart Page');
        }
        
        // Wire up Clear Cart Button
        const clearBtn = document.getElementById('clearCartBtn');
        if (clearBtn) clearBtn.addEventListener('click', handleClearCart);
    }
    
    // Start system initialization
    document.addEventListener('DOMContentLoaded', initializeCartSystem);

  </script>
 </body>
</html>
