<!doctype html>
<html lang="th">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title id="pageTitle">Product Detail - Nexus Wear</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&amp;family=Bebas+Neue&amp;display=swap" rel="stylesheet">
  
  <script src="./_sdk/element_sdk.js"></script>
  <script src="./_sdk/data_sdk.js"></script>
  <script src="./_sdk/data_utility.js"></script>
  <script src="./_sdk/analytics_sdk.js"></script>
  
  <style>
        /* (CSS Styles are kept the same for brevity - Your original styles here) */
        body {
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
            background: #FFFFFF;
            color: #000000;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Layout */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* Header */
        header {
            background-color: #111111;
            color: #FFFFFF;
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 2px solid #FF00FF; 
        }

        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .brand-logo {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2rem;
            text-decoration: none;
            color: #FFFFFF;
            letter-spacing: 2px;
        }

        .nav-icons {
            display: flex;
            align-items: center;
        }

        .nav-icons a {
            color: #FFFFFF;
            text-decoration: none;
            margin-left: 20px;
            font-size: 1.2rem;
            position: relative;
        }
        
        .cart-badge {
            position: absolute;
            top: -5px;
            right: -10px;
            background-color: #FF00FF;
            color: #111111;
            border-radius: 50%;
            padding: 2px 6px;
            font-size: 0.7rem;
            font-weight: 700;
            min-width: 20px;
            text-align: center;
        }
        
        /* Product Detail Layout */
        .product-container {
            display: flex;
            gap: 40px;
            padding: 60px 0;
        }

        .product-gallery {
            flex: 1;
        }

        .main-image {
            width: 100%;
            aspect-ratio: 4/5;
            object-fit: cover;
            margin-bottom: 10px;
            border: 1px solid #EEEEEE;
        }

        .thumbnails {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding-bottom: 10px;
        }

        .thumbnail-image {
            width: 80px;
            height: 100px;
            object-fit: cover;
            cursor: pointer;
            border: 2px solid transparent;
            transition: border-color 0.3s;
        }
        
        .thumbnail-image.active {
            border-color: #FF00FF;
        }

        .product-details {
            flex: 1;
        }
        
        .product-name {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 3rem;
            margin-bottom: 10px;
            letter-spacing: 1px;
        }

        .product-price {
            font-size: 2rem;
            color: #FF00FF;
            font-weight: 700;
            margin-bottom: 20px;
        }
        
        .product-description {
            font-size: 1rem;
            line-height: 1.7;
            margin-bottom: 30px;
            color: #444;
        }

        /* Options */
        .options h4 {
            font-size: 1.1rem;
            margin-bottom: 10px;
        }

        .option-group {
            margin-bottom: 20px;
        }

        .size-option, .color-option {
            display: inline-block;
            border: 1px solid #CCCCCC;
            padding: 8px 15px;
            margin-right: 10px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
        }
        
        .size-option.selected {
            border-color: #FF00FF;
            background-color: #FF00FF;
            color: #111111;
        }
        
        .color-selector {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 10px;
            cursor: pointer;
            border: 3px solid transparent;
        }
        
        .color-selector.selected {
            border-color: #FF00FF;
            box-shadow: 0 0 5px #FF00FF;
        }
        
        /* Quantity */
        .quantity-control {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .quantity-control button {
            background-color: #EEEEEE;
            border: 1px solid #CCCCCC;
            padding: 5px 10px;
            font-size: 1.2rem;
            cursor: pointer;
        }

        .quantity-input {
            width: 50px;
            text-align: center;
            border: 1px solid #CCCCCC;
            border-left: none;
            border-right: none;
            height: 38px;
            line-height: 38px;
            font-size: 1rem;
            -moz-appearance: textfield; /* Hide arrows in Firefox */
        }
        
        .quantity-input::-webkit-outer-spin-button,
        .quantity-input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        /* Action Buttons */
        .action-buttons button {
            width: 100%;
            padding: 15px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            border: none;
            margin-bottom: 10px;
        }

        #addToCartBtn {
            background-color: #111111;
            color: #FFFFFF;
            transition: background-color 0.3s;
        }
        
        #addToCartBtn:hover {
            background-color: #FF00FF;
            color: #111111;
        }
        
        #buyNowBtn {
            background-color: #FFFFFF;
            color: #111111;
            border: 2px solid #111111;
            transition: all 0.3s;
        }
        
        #buyNowBtn:hover {
            border-color: #FF00FF;
            color: #FF00FF;
        }

        /* Product Details Accordion */
        .product-details-accordion {
            margin-top: 40px;
            border-top: 1px solid #EEEEEE;
        }
        
        .detail-item {
            border-bottom: 1px solid #EEEEEE;
        }

        .detail-header {
            padding: 15px 0;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .detail-header::after {
            content: '+';
            font-size: 1.5rem;
            transition: transform 0.3s;
        }

        .detail-item.active .detail-header::after {
            content: '‚àí';
            transform: rotate(180deg);
        }

        .detail-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            padding: 0 0;
        }
        
        .detail-item.active .detail-content {
            max-height: 300px; /* Adjust as needed for content height */
            padding: 10px 0 20px;
        }

        /* Footer */
        footer {
            background-color: #111111;
            color: #AAAAAA;
            padding: 40px 0;
            text-align: center;
            border-top: 2px solid #FF00FF;
        }

        /* Toast Notification */
        #toast {
            visibility: hidden;
            min-width: 250px;
            margin-left: -125px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 2px;
            padding: 16px;
            position: fixed;
            z-index: 1010;
            left: 50%;
            bottom: 30px;
            font-size: 17px;
        }
        
        #toast.show {
            visibility: visible;
            -webkit-animation: fadein 0.5s, fadeout 0.5s 2.5s;
            animation: fadein 0.5s, fadeout 0.5s 2.5s;
        }
        
        @-webkit-keyframes fadein {
            from {bottom: 0; opacity: 0;} 
            to {bottom: 30px; opacity: 1;}
        }

        @keyframes fadein {
            from {bottom: 0; opacity: 0;}
            to {bottom: 30px; opacity: 1;}
        }

        @-webkit-keyframes fadeout {
            from {bottom: 30px; opacity: 1;} 
            to {bottom: 0; opacity: 0;}
        }

        @keyframes fadeout {
            from {bottom: 30px; opacity: 1;}
            to {bottom: 0; opacity: 0;}
        }

        /* Media Queries */
        @media (max-width: 768px) {
            .product-container {
                flex-direction: column;
                padding: 30px 0;
            }
            
            .product-details {
                order: -1; /* Move details section above gallery on mobile */
            }
            
            .product-name {
                font-size: 2.5rem;
            }
        }
  </style>
 </head>
 <body>
  
  <header>
    <div class="container">
        <nav class="navbar">
            <a href="index.html" class="brand-logo" id="brandLogo">NEXUS WEAR</a>
            
            <div class="nav-icons">
                <a href="cart.html" title="Shopping Cart">
                    üõí
                    <span class="cart-badge" id="cartBadge">0</span>
                </a>
            </div>
        </nav>
    </div>
  </header>

  <main>
      <section class="container">
          <div class="product-container">
              
              <div class="product-gallery">
                  <img src="https://via.placeholder.com/600x750?text=Loading..." alt="Main Product Image" class="main-image" id="mainProductImage">
                  <div class="thumbnails" id="productThumbnails">
                      </div>
              </div>
              
              <div class="product-details">
                  <span class="product-category" id="productCategory">LOADING...</span>
                  <h1 class="product-name" id="productName">LOADING PRODUCT DETAILS</h1>
                  <p class="product-price" id="productPrice">0 THB</p>
                  
                  <p class="product-description" id="productDescription">Loading product description...</p>

                  <div class="options">
                      <div class="option-group" id="sizeOptions">
                          <h4>SIZE: <span id="selectedSize">S</span></h4>
                          </div>
                      
                      <div class="option-group" id="colorOptions">
                          <h4>COLOR: <span id="selectedColor">Black</span></h4>
                          </div>
                  </div>
                  
                  <div class="quantity-control">
                      <button id="qtyDecrease">-</button>
                      <input type="number" id="qtyInput" class="quantity-input" value="1" min="1" readonly>
                      <button id="qtyIncrease">+</button>
                  </div>

                  <div class="action-buttons">
                      <button id="addToCartBtn">ADD TO CART</button>
                      <button id="buyNowBtn">BUY NOW</button>
                  </div>
                  
                  <div class="product-details-accordion">
                      <div class="detail-item">
                          <div class="detail-header">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>
                          <div class="detail-content">
                              <p id="detailContentDescription">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</p>
                          </div>
                      </div>
                      <div class="detail-item">
                          <div class="detail-header">‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡πÅ‡∏•‡∏∞‡∏Ñ‡∏∑‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>
                          <div class="detail-content">
                              <p>‡∏™‡πà‡∏á‡∏ü‡∏£‡∏µ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏±‡πà‡∏á‡∏Ñ‡∏£‡∏ö 1,500 ‡∏ö‡∏≤‡∏ó. ‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏∑‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 7 ‡∏ß‡∏±‡∏ô</p>
                          </div>
                      </div>
                  </div>
              </div>
          </div>
      </section>
  </main>
  
  <footer>
      <div class="container">
          <p>&copy; 2023 <span id="footerBrand">NEXUS WEAR</span>. All Rights Reserved.</p>
          <p><a href="index.html">Back to Home</a></p>
      </div>
  </footer>

  <div id="toast"></div>

  <script>
    // ===========================================
    // GLOBAL STATE & UTILITIES
    // ===========================================
    let currentProductData = null;
    let selectedSize = '';
    let selectedColorName = '';
    let selectedColorHex = '';
    
    /**
     * ‡∏ä‡πà‡∏ß‡∏¢‡∏à‡∏±‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô THB
     */
    const formatCurrency = (amount) => {
        return `${parseFloat(amount).toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ',')} THB`;
    };

    /**
     * ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° Toast Notification
     */
    function showToast(message, type = 'success') {
      const toast = document.getElementById('toast');
      if (!toast) return;

      toast.textContent = message;
      toast.className = 'show';
      
      // Set color based on type (simple example)
      toast.style.backgroundColor = type === 'error' ? '#D32F2F' : '#333';
      
      setTimeout(function(){ 
        toast.className = toast.className.replace('show', ''); 
      }, 3000);
    }
    
    /**
     * ‡∏î‡∏∂‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏à‡∏≤‡∏Å Data SDK
     */
    function updateCartCountFromSDK() {
        if (window.dataSdk) {
            const count = window.dataSdk.getCartCount();
            const badge = document.getElementById('cartBadge');
            if (badge) {
                badge.textContent = count > 99 ? '99+' : count;
                badge.style.display = count > 0 ? 'inline-block' : 'none';
            }
        }
    }
    
    /**
     * Data SDK handler: ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á
     */
    function dataChangedHandler(cart) {
        updateCartCountFromSDK(); 
    }
    
    /**
     * ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Data SDK
     */
    async function initializeDataSdk() {
        if (window.dataSdk) {
            await window.dataSdk.init({ onDataChanged: dataChangedHandler });
            updateCartCountFromSDK();
        }
    }


    // ===========================================
    // DATA UTILITY & RENDERING (The Fix is here)
    // ===========================================
    
    /**
     * ‡∏î‡∏∂‡∏á Product ID ‡∏à‡∏≤‡∏Å Query Parameter ‡πÉ‡∏ô URL
     * **‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:** ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô loadProductDataAndRender 
     * ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤ MOCK_PRODUCTS_DATA ‡∏ñ‡∏π‡∏Å‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡πâ‡∏ß
     * @returns {string | null} Product ID
     */
    function getProductIdFromURL() {
      const urlParams = new URLSearchParams(window.location.search);
      const id = urlParams.get('id'); 
      
      // Fallback: ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏û‡∏ö ID ‡πÉ‡∏ô URL ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ ID ‡∏Ç‡∏≠‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏£‡∏Å‡∏™‡∏∏‡∏î‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
      if (!id && window.MOCK_PRODUCTS_DATA && window.MOCK_PRODUCTS_DATA.length > 0) {
          return window.MOCK_PRODUCTS_DATA[0].id; 
      }
      
      return id;
    }

    /**
     * ‡πÄ‡∏£‡∏ô‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏•‡∏á‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤
     * @param {Object} product - ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
     */
    function renderProductDetails(product) {
        document.getElementById('productCategory').textContent = product.category.toUpperCase();
        document.getElementById('productName').textContent = product.name;
        document.getElementById('productPrice').textContent = formatCurrency(product.price);
        document.getElementById('productDescription').textContent = product.description;
        document.getElementById('detailContentDescription').textContent = product.description;
        
        // Main Image
        const mainImageEl = document.getElementById('mainProductImage');
        if (mainImageEl) {
            mainImageEl.src = product.image;
        }
    }

    /**
     * ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏ô‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
     * **‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:** ‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á ID ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ
     */
    function loadProductDataAndRender() {
      // ‡∏î‡∏∂‡∏á Product ID ‡∏ì ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ñ‡∏π‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏Å (‡∏´‡∏•‡∏±‡∏á SDK/Utility ‡πÇ‡∏´‡∏•‡∏î)
      const currentProductId = getProductIdFromURL();
      
      console.log('Product ID:', currentProductId); 
      
      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ dataUtility ‡πÅ‡∏•‡∏∞ productId ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
      if (typeof window.dataUtility === 'undefined' || !currentProductId) {
          // V V V V V V V V V V V V V V V V V V V V V V V V V V V V V V V V V V
          // **‡∏à‡∏∏‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:** ‡πÅ‡∏™‡∏î‡∏á Error message ‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô
          document.getElementById('productName').textContent = 'Error: Data Utility or Product ID Missing';
          document.getElementById('pageTitle').textContent = 'Error';
          document.querySelector('.product-container').innerHTML = `
              <h1 style="text-align: center; padding: 100px;">
                  Error: Data Utility or Product ID Missing.<br> 
                  ‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÑ‡∏ü‡∏•‡πå data_utility.js ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà<br>
                  ‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤ Index ‡∏°‡∏µ Product ID (‡πÄ‡∏ä‡πà‡∏ô product.html?id=xxx)
              </h1>
          `;
          // ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^
          return;
      }
      
      const product = window.dataUtility.getProductById(currentProductId);

      if (!product) {
        document.getElementById('productName').textContent = '404: PRODUCT NOT FOUND';
        document.getElementById('pageTitle').textContent = '404';
        document.querySelector('.product-container').innerHTML = `<h1 style="text-align: center; padding: 100px;">404: ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏û‡∏ö ID: ${currentProductId}</h1>`;
        return;
      }
      
      currentProductData = product;
      
      // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
      selectedSize = product.available_sizes[0] || '';
      selectedColorName = product.available_colors[0]?.name || '';
      selectedColorHex = product.available_colors[0]?.hex || '';

      renderProductDetails(product); 
      renderThumbnails(product.gallery_images); 
      renderOptions(product);
      
      initializeAccordion();
    }


    // ===========================================
    // RENDERING HELPERS
    // ===========================================

    function renderThumbnails(images) {
      const container = document.getElementById('productThumbnails');
      if (!container) return;
      container.innerHTML = '';

      images.forEach((url, index) => {
        const img = document.createElement('img');
        img.src = url;
        img.className = 'thumbnail-image';
        img.alt = `Thumbnail ${index + 1}`;
        img.setAttribute('data-index', index);
        if (index === 0) {
            img.classList.add('active');
        }
        container.appendChild(img);
      });
      wireUpThumbnails();
    }
    
    function renderOptions(product) {
        const sizeContainer = document.getElementById('sizeOptions');
        const colorContainer = document.getElementById('colorOptions');

        // Render Sizes
        if (sizeContainer) {
            let sizeHtml = `<h4>SIZE: <span id="selectedSize">${selectedSize}</span></h4>`;
            product.available_sizes.forEach(size => {
                const isSelected = size === selectedSize ? ' selected' : '';
                sizeHtml += `<span class="size-option${isSelected}" data-size="${size}">${size}</span>`;
            });
            sizeContainer.innerHTML = sizeHtml;
            
            // Wire up size selection
            sizeContainer.querySelectorAll('.size-option').forEach(option => {
                option.addEventListener('click', function() {
                    sizeContainer.querySelectorAll('.size-option').forEach(s => s.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedSize = this.dataset.size;
                    document.getElementById('selectedSize').textContent = selectedSize;
                });
            });
        }
        
        // Render Colors
        if (colorContainer) {
            let colorHtml = `<h4>COLOR: <span id="selectedColor">${selectedColorName}</span></h4>`;
            product.available_colors.forEach(color => {
                const isSelected = color.name === selectedColorName ? ' selected' : '';
                colorHtml += `<span class="color-selector${isSelected}" data-name="${color.name}" data-hex="${color.hex}" style="background-color: ${color.hex};" title="${color.name}"></span>`;
            });
            colorContainer.innerHTML = colorHtml;

            // Wire up color selection
            colorContainer.querySelectorAll('.color-selector').forEach(option => {
                option.addEventListener('click', function() {
                    colorContainer.querySelectorAll('.color-selector').forEach(c => c.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedColorName = this.dataset.name;
                    selectedColorHex = this.dataset.hex;
                    document.getElementById('selectedColor').textContent = selectedColorName;
                });
            });
        }
    }


    // ===========================================
    // CART & ACTION LOGIC
    // ===========================================
    
    /**
     * ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏•‡∏á‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ Data SDK
     */
    async function addToCart() {
      const qtyInput = document.getElementById('qtyInput');
      const quantity = parseInt(qtyInput ? qtyInput.value : '1', 10);
      
      if (!currentProductData || !window.dataSdk) {
          showToast('Initialization Error: Product Data or SDK Missing', 'error');
          return { isOk: false, error: 'Initialization Error' };
      }

      if (!selectedSize || !selectedColorName) {
          showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Size ‡πÅ‡∏•‡∏∞ Color', 'error');
          return { isOk: false, error: 'Check options' };
      }

      const item = {
          product_id: currentProductData.id,
          name: currentProductData.name,
          image: currentProductData.image,
          price: currentProductData.price,
          size: selectedSize,
          color: selectedColorName,
          color_hex: selectedColorHex,
          quantity: quantity
      };

      const result = await window.dataSdk.addToCart(item);

      if (result.isOk) {
          showToast(`‡πÄ‡∏û‡∏¥‡πà‡∏° ${quantity} ‡∏ä‡∏¥‡πâ‡∏ô (${selectedSize}, ${selectedColorName}) ‡∏•‡∏á‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß`);
          if (window.analyticsSdk) {
              window.analyticsSdk.trackEvent('AddToCart', { product_id: item.product_id, size: item.size, color: item.color, quantity: item.quantity, price: item.price });
          }
      } else {
          showToast(`Error: ${result.error}`, 'error');
      }
      
      return result;
    }


    // ===========================================
    // UI HANDLERS
    // ===========================================

    // Quantity Control Logic
    function wireUpQuantityControl() {
        const qtyInput = document.getElementById('qtyInput');
        const increaseBtn = document.getElementById('qtyIncrease');
        const decreaseBtn = document.getElementById('qtyDecrease');
        
        if (qtyInput && increaseBtn) {
            increaseBtn.addEventListener('click', () => {
                qtyInput.value = Math.max(1, parseInt(qtyInput.value, 10) + 1);
            });
        }
        
        if (qtyInput && decreaseBtn) {
            decreaseBtn.addEventListener('click', () => {
                qtyInput.value = Math.max(1, parseInt(qtyInput.value, 10) - 1);
            });
        }
    }

    // Thumbnail Switch Logic
    function wireUpThumbnails() {
      document.querySelectorAll('.thumbnail-image').forEach(img => {
        img.addEventListener('click', function() {
          // Remove active class from all
          document.querySelectorAll('.thumbnail-image').forEach(i => i.classList.remove('active'));
          // Add active class to clicked one
          this.classList.add('active');
          
          // Change main image source
          const mainImageEl = document.getElementById('mainProductImage');
          if (img && mainImageEl) {
            mainImageEl.src = img.src;
          }
        });
      });
    }
    
    // Accordion Logic
    function initializeAccordion() {
        document.querySelectorAll('.detail-header').forEach(header => {
            header.addEventListener('click', () => {
                const item = header.closest('.detail-item');
                item.classList.toggle('active');
            });
        });
    }


    // Hook up buttons
    function wireUpButtons() {
      // Quantity controls
      wireUpQuantityControl();

      const addBtn = document.getElementById('addToCartBtn');
      if (addBtn) addBtn.addEventListener('click', addToCart);
      
      const buyNowBtn = document.getElementById('buyNowBtn');
      if (buyNowBtn) buyNowBtn.addEventListener('click', () => {
        // Buy Now: Add to cart then redirect to cart page
        addToCart().then((result) => {
           if (result && result.isOk) {
             window.location.href = 'cart.html';
           } else if (result) {
             showToast(`Buy Now failed: ${result.error || 'Check options'}`, 'error');
           }
        });
      });
    }

    // ===========================================
    // INITIALIZATION
    // ===========================================

    document.addEventListener('DOMContentLoaded', async () => {
      // 1. Initialize SDKs
      await initializeDataSdk(); // ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏° Data SDK ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Cart Badge ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ

      // Initialize Element SDK
      const defaultConfig = { 
        page_title: 'PRODUCT DETAIL', 
        brand_name: 'NEXUS WEAR', 
      };
      
      function handleConfigChange(config) {
        document.getElementById('pageTitle').textContent = config.page_title || defaultConfig.page_title;
        document.getElementById('brandLogo').textContent = config.brand_name || defaultConfig.brand_name;
        const footerBrandEl = document.getElementById('footerBrand');
        if (footerBrandEl) footerBrandEl.textContent = config.brand_name || defaultConfig.brand_name;
      }
      
      if (window.elementSdk) {
            window.elementSdk.init({
                defaultConfig: defaultConfig,
                onConfigChange: handleConfigChange
            });
      }
      if (window.analyticsSdk) {
            window.analyticsSdk.init();
            window.analyticsSdk.trackPageView('Product Detail Page');
      }

      // 2. Load Data and Render UI
      loadProductDataAndRender(); // **‡∏à‡∏∏‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:** ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
      
      // 3. Wire up Event Listeners
      wireUpButtons();
    });

  </script>
 </body>
</html>
